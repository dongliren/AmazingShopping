package com.oracle.shop.model.daoImpl.entity;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import com.oracle.shop.model.daoImpl.CommonDaoImpl;
import com.oracle.shop.model.entity.Goods;
import com.oracle.shop.model.entity.UserOrderlist;
import com.oracle.shop.util.JdbcTemplate;
import com.oracle.shop.util.JdbcTemplate.PreparedStateMentSetter;
import com.oracleoaec.exception.DataAccessException;

public class OrderListImpl extends CommonDaoImpl<UserOrderlist> {

	

	@Override
	public List<UserOrderlist> findOrderlist(final int status) {
		return JdbcTemplate.Query("select orderliset_id,order_number,ORDERTIME,PRICE,AMOUNT,TYPEID,BRANDNAME,ORDERTYPE,totalprice,imgpath,discribe from user_orderlist where ordertype=?",
				new PreparedStateMentSetter() {
					@Override
					public void setValues(PreparedStatement pstmt) throws SQLException {
						//System.out.println("111");
						pstmt.setInt(1, status);
						//System.out.println("222");
					}
				}, createHandler());
	}
	
	private JdbcTemplate.RowCallBackHandel<UserOrderlist> createHandler(){
		return new JdbcTemplate.RowCallBackHandel<UserOrderlist>() {
			@Override
			public UserOrderlist processRow(ResultSet re) throws SQLException {
				//System.out.println("333");
				UserOrderlist orderlist=new UserOrderlist();
				orderlist.setAmount(re.getInt("AMOUNT"));
				orderlist.setBrandName(re.getString("BRANDNAME"));
				orderlist.setOrderLisetid(re.getInt("orderliset_id"));
				orderlist.setOrderNumber(re.getDouble("order_number"));
				orderlist.setOrderTime(re.getDate("ORDERTIME"));
				orderlist.setOrderType(re.getInt("ORDERTYPE"));
				orderlist.setPrice(re.getDouble("PRICE"));
				orderlist.setTypeId(re.getInt("TYPEID"));
				orderlist.setDiscribe(re.getString("discribe"));
				orderlist.setImgpath(re.getString("imgpath"));
				orderlist.setTotalprice(re.getDouble("totalprice"));
				//System.out.println(orderlist);
				return orderlist;
			}
		};
	}
	/**
	 * 朱彬重写save方法，保存添加到购物车的信息
	 * */
	@Override
	public int save(final UserOrderlist t) {
		return JdbcTemplate.update("insert into user_orderlist(orderliset_id,ORDERTIME,PRICE,AMOUNT,TYPEID,BRANDNAME,ORDERTYPE,totalprice,imgpath,discribe) values(s_orderlist.nextval,?,?,?,?,?,?,?,?,?)", 
				new PreparedStateMentSetter() {
			@Override
			public void setValues(PreparedStatement pstmt) throws SQLException {
				pstmt.setDate(1, t.getOrderTime());
				pstmt.setDouble(2, t.getPrice());
				pstmt.setInt(3, t.getAmount());
				pstmt.setInt(4, t.getTypeId());
				pstmt.setString(5, t.getBrandName());
				pstmt.setInt(6, t.getOrderType());
				pstmt.setDouble(7, t.getTotalprice());
				pstmt.setString(8, t.getImgpath());
				pstmt.setString(9, t.getDiscribe());
			}
		});
	}

	@Override
	public List<Goods> findByType(int id) throws DataAccessException {
		// TODO Auto-generated method stub
		return null;
	}

}
